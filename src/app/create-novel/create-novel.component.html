<app-navbar></app-navbar>
<app-lockpage></app-lockpage>
<div class="container-page">
  <div class="containerfornav">
    <div class="container">
      <div class="form-group">
        <div class="header">
          ‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢ ({{ typeMapping()[novel.type] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}})
        </div>
        <div class="file-upload-head">
          <div class="file-upload-sub">
            <div class="file-upload" (click)="fileInput.click()">
              <label class="file-label">
                <i class="upload-icon">üìÅ</i>
                <p>Drag & Drop your files here or click to upload</p>
              </label>
              <div id="croppedImageContainer">
                <img [src]="uploadService.croppedImage" alt="Cropped Image Preview" />
              </div>
              <input #fileInput type="file" id="fileInput" accept="image/*" (change)="onFileChange($event)"
                style="display: none;" />
            </div>
            
            <div id="cropModal" >
              <div class="modal-content">
                <div class="image-container">
              <img id="imagePreview" alt="Image preview for cropping" />
            </div>
              <button (click)="cropImage()">Crop</button>
              <button >Close</button>
            </div>
            </div>
            <div class="penname">
              <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
              <a id="penNameInput" *ngIf="!isEditingPenName" (click)="penName()">
                {{ novel.penName ? novel.penName : '+ ‡∏ô‡∏≤‡∏°‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤' }}
              </a>

              <!-- ‡πÅ‡∏™‡∏î‡∏á input ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
              <input *ngIf="isEditingPenName" #penNameInput type="text" maxlength="20" [(ngModel)]="novel.penName"
                (ngModelChange)="saveToLocalStorage()" (keydown.enter)="confirmPenName()">
            </div>
          </div>
          <div id="croppedImageContainer" style="display: none;">
            <img id="croppedImage" alt="Cropped Image Preview" />
          </div>



          <div class="form-group-1">
            <label for="title">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ({{countName()}}/50)</label>
            <input id="title" name="title" [(ngModel)]="novel.novelName" (ngModelChange)="saveToLocalStorage()"
              type="text" maxlength="50">
            <label for="subtitle">‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢/‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠ ({{countDesc()}}/120)</label>
            <textarea id="subtitle" name="subtitle" [(ngModel)]="novel.desc" (ngModelChange)="saveToLocalStorage()"
               maxlength="120"></textarea>
          </div>
        </div>
      </div>


      <div class="form-group">
        <label for="main-category">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å</label>
        <div class="dropdown-container ">
          <select id="subItemSelect" [(ngModel)]="selectedItem" (change)="onSelectItem($event)"
            (ngModelChange)="saveToLocalStorage()">
            <option value="" disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å</option>
            <!-- Group items -->
            <optgroup *ngFor="let group of groupedData | keyvalue" [label]="group.key">
              <!-- Sub-item option with tooltip for 'desc' on hover -->
              <option *ngFor="let subItem of group.value" [value]="subItem.label" [title]="subItem.desc">
                {{ subItem.label }}
              </option>
            </optgroup>
          </select>
        </div>
        <br>

        <div class="main-category-sub">
          <div class="category-sub">
            <label for="sub-category1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≠‡∏á 1 <b>(‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)</b></label>
            <select id="sub-category1" name="sub-category1" [(ngModel)]="novel.selectedSubCategory1"
              (ngModelChange)="saveToLocalStorage()">
              <option value="" disabled>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≠‡∏á</option>
              <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á -->
              <option *ngFor="let subGroup of filteredSubGroups('sub-category1')" [value]="subGroup.label">
                {{ subGroup.label }}
              </option>
            </select>
          </div>

          <div class="category-sub">
            <label for="sub-category2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≠‡∏á 2 <b>(‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)</b></label>
            <select id="sub-category2" name="sub-category2" [(ngModel)]="novel.selectedSubCategory2"
              (ngModelChange)="saveToLocalStorage()">
              <option value="" disabled>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≠‡∏á</option>
              <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á -->
              <option *ngFor="let subGroup of filteredSubGroups('sub-category2')" [value]="subGroup.label">
                {{ subGroup.label }}
              </option>
            </select>
          </div>
        </div>

      </div>

      <div class="form-group">
        <label for="rating">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Rating)</label>
        <select id="rating" name="rating" [(ngModel)]="novel.rate" (ngModelChange)="saveToLocalStorage()">
          <option value="" disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</option>
          <option *ngFor="let rate of rates">{{ rate.rate }}</option>
        </select>
        <label class="tags-head">‡πÅ‡∏ó‡πá‡∏Å ({{ countTags() }}/20)</label>
        <div class="tags">
          <span *ngFor="let tag of tagsArray" (click)="deltag(tag)" class="tag">
            {{ tag }} <span class="remove-tag">√ó</span>
          </span>
        </div>

        <label for="tags">‡πÅ‡∏ó‡πá‡∏Å‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</label>
        <div class="tags">
          <span *ngFor="let tag of tageRec; trackBy: trackByTag" (click)="addTagRec(tag.tag)" class="tag">
            {{ tag.tag }}
          </span>
        </div>

        <input name="tags" type="text" maxlength="20" placeholder="‡πÉ‡∏™‡πà‡πÅ‡∏ó‡πá‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏Å‡πÉ‡∏´‡∏°‡πà)" (keyup.enter)="addTag()"
          [(ngModel)]="newTag" />
      </div>

      <div class="buttons" *ngIf="checkform">
        <a>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</a>
        <div class="toggle-button-cover">
          <a id="status">{{ novel.status === 'T' ? '‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß' : '‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞' }}</a>
          <div class="button r" id="button-3">
            <input type="checkbox" class="checkbox" (change)="toggleStatus($event)">
            <div class="knobs"></div>
            <div class="layer"></div>
          </div>
        </div>
        <div class="buttons-sub">
          <button class="back-button" (click)="goBack()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <button class="submit-button" (click)="presubmit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </div>
    </div>
  </div>
</div>
<app-popup></app-popup>